# 荒川区テニスコート予約bot 要件定義
更新日: 20260217

---

## 1. スコープ
- 対象は「荒川区テニスコート」の予約botのみ
- 既存のスクレイピング・通知・実行トリガーはなるべく変更しない

---

## 2. 自動予約の基本方針
- 空き枠を検知したら、条件を満たす場合は確認なしで即予約する
- 予約成功時は必ず通知する
- 予約後のキャンセル判断・操作はユーザーが手動で行う

---

## 3. 予約対象条件

### 日時条件
- 土日祝のみを対象とする
- 予約枠は 2時間固定
- 開始時刻は以下のみを対象とする
  - **09:00 / 11:00 / 13:00 / 15:00/ 17:00 / 19:00**

### 直近予約禁止ルール
- 実行日を起点として、3日以内の予約枠は除外する
- 例：
  - 火曜日に実行した場合、金曜日までの枠は予約不可
  - 土曜日以降の枠のみ予約対象とする
  - 予約対象のコートは、既存の Selenium スクレイピング対象として定義されているコートのみとする
  （`selenium_check.py` 内の `PARK_KEYWORDS` に含まれる公園）

---

## 4. Googleカレンダー参照ルール
- Googleカレンダー上の「すべての予定」を予約不可扱いとする
- 予約枠の **前後2時間** を含めて予定が存在しない場合のみ予約可とする
- 例：
  - 13:00–15:00 の予約枠の場合
    → 11:00–17:00 に予定が1件でもあれば予約不可

### カレンダー参照の最適化
- 1回の実行サイクルの開始時に、対象期間の予定をまとめて取得してキャッシュする
- 候補枠ごとの空き判定は、キャッシュした予定に対してローカル計算で行う（候補ごとにAPIを叩かない）

---

## 5. 失敗時の振る舞い
- 予約に失敗した場合は、別の時間帯または別コートの候補を探して再実行する
- 区営テニスコートのカレンダー上で取得できた候補をすべて判定し終えたら処理を終了する
- 同一実行サイクル内で総当たりしたら終了し、次回実行に委ねる

---

## 6. 通知要件
- 予約成功時は必ず通知する
- 通知には以下の情報を含める（取得可能な範囲で）
  - 予約日時（開始・終了）
  - 公園名／コート識別情報
  - 予約番号等の識別子
- 通知後、予約キャンセルが必要な場合はユーザーが手動で行う

---

## 7. 対象外・注意事項
- 振込決済処理は行わない
- 実行頻度・スケジューラの設計は本要件では扱わない
- 既存のスクレイピング・通知・プロセス起動構造は維持する
